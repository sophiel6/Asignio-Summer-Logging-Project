
@using AsignioInternship.Data.CombinedLogException
@using AsignioInternship.Data


@model PagedDataModelCollection<CombinedLogExceptionDataModel>
@{
    ViewBag.Title = "IndexToo";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
@{
    var searchBy = Model.SearchBy;
    var searchInput = Model.SearchInput;
    var sortBy = Model.SortBy;
    var sortDir = Model.SortDirection;
    var id = Model.PageNumber;
    IDictionary<string, string> searchDict = Model.SearchDictionary;

    List<String> categories = new List<String>() { "EmailAddress", "TimeStamp", "WebRequestID", "Message", "MethodName", "Source", "StackTrace", "Important" };

    bool noResults = (Model.TotalItems) == 0;
}



<!-- Paging stuff -->
<div class="container" style="padding-top: 50px !important;">
    <div class="row">
        <div class="col-md-4">
            <label class="pageLabel"> Current page: @Model.PageNumber / @Model.TotalPages</label>
        </div>
        <div class="col-md-4">
            <div class="btn-group">
                @Html.ActionLink(linkText: " << First",
                                actionName: "IndexToo",
                                controllerName: "LogException",
                                routeValues: new { sortBy = sortBy, sortDir = sortDir, id = 1, searchDictionary = searchDict },
                                htmlAttributes: new { @class = "btn btn-default" })
                @Html.ActionLink(linkText: "< Previous",
                                actionName: "IndexToo",
                                controllerName: "LogException",
                                routeValues: new { sortBy = sortBy, sortDir = sortDir, id = ((id - 1) != 0) ? (id - 1) : id, searchDictionary = searchDict },
                                htmlAttributes: new { @class = "btn btn-default" })
                @Html.ActionLink(linkText: "Next >",
                                actionName: "IndexToo",
                                controllerName: "LogException",
                                routeValues: new { sortBy = sortBy, sortDir = sortDir, id = ((id + 1) <= Model.TotalPages) ? (id + 1) : id, searchDictionary = searchDict },
                                htmlAttributes: new { @class = "btn btn-default" })
                @Html.ActionLink(linkText: "Last >>",
                                actionName: "IndexToo",
                                controllerName: "LogException",
                                routeValues: new { sortBy = sortBy, sortDir = sortDir, id = Model.TotalPages, searchDictionary = searchDict },
                                htmlAttributes: new { @class = "btn btn-default" })
            </div>
        </div>
    </div>
</div>

<!-- using (Html.BeginRouteForm(new { controller = "LogException", action = "IndexToo", id = 1, sortBy = sortBy, sortDir = sortDir }))
{
    Html.HiddenFor(m => m.SearchDictionary)
    <input type="submit" name="btnSubmit" value="First" class="btn btn-default" style="width: 50px; display: inline-block;" />
} -->

<!-- Next button -->
<button onClick ="NextButton(@id+1, '@sortBy', '@sortDir', @Model.SearchDictionary)"> Next </button>

@if (!noResults)
{
    <table style="width:100%; text-align:center;">
        <thead>
            <tr>
                @foreach (String category in categories)
                {
                    var sortB = "";
                    var sortD = "";
                    var className = "";

                    if (sortBy == category)
                    {
                        sortB = sortBy;
                        className = "sortLink";<!-- If sortBy == the category name, make the link underlined -->

                        if (sortDir == "ASC")
                        { sortD = "DESC"; }
                        else
                        { sortD = "ASC"; }
                    }
                    else
                    {
                        sortB = category;
                        sortD = "ASC";
                    }
                    <td>
                        @Html.ActionLink(category, "IndexToo", new { sortBy = sortB, sortDir = sortD, searchBy = searchBy, searchInput = searchInput, id = 1 }, new { @class = className })
                    </td>
                }
            </tr>
        </thead>
        <tbody>
            @foreach (CombinedLogExceptionDataModel currentRow in Model.Items)
            {
                <tr>
                    <td>@currentRow.EmailAddress</td>
                    <td>@currentRow.TimeStamp</td>
                    <td>@currentRow.WebRequestID</td>
                    <td>@currentRow.Message</td>
                    <td>@currentRow.MethodName</td>
                    <td>@currentRow.Source</td>
                    <td>@currentRow.StackTrace</td>
                    <td>@currentRow.Important</td>
                </tr>
            }
        </tbody>
    </table>
}
else
{
    <h2> No results found. </h2>
}

<script>
    var currentid = null;
    var currentsortBy = null;
    var currentsortDir = null;
    var currentsearchDictionary = null;

    function NextButton(page, sortB, sortD, searchD) {
        currentid = page;
        currentsortBy = sortB;
        currentsortDir = sortD;
        currentsearchDictionary = searchD;

        var dictionary = [];
        for (var key in currentsearchDictionary) {
            if (currentsearchDictionary.hasOwnProperty(key)) {
                dictionary.push({ Key: key, Value: currentsearchDictionary[key] });
            }
        }
        const form = document.createElement('form');
        form.method = 'post';
        form.action = '/LogException/IndexToo';

        for (const key in dictionary) {
            if (dictionary.hasOwnProperty(key)) {
                const hiddenField = document.createElement('input');
                hiddenField.type = 'hidden';
                hiddenField.name = key;
                hiddenField.value = dictionary[key];
                form.appendChild(hiddenField);
            }
        }
        const id = document.createElement('input');
        id.type = 'hidden';
        id.name = 'id';
        id.value = currentid;
        form.appendChild(id);

        const sortBy = document.createElement('input');
        sortBy.type = 'hidden';
        sortBy.name = 'sortBy';
        sortBy.value = currentsortBy;
        form.appendChild(sortBy);

        const sortDir = document.createElement('input');
        sortDir.type = 'hidden';
        sortDir.name = 'sortDir';
        sortDir.value = currentsortDir;
        form.appendChild(sortDir);

        document.body.appendChild(form);
        form.submit();
    };
</script>
