<!-- LogException Advanced Search page -->

@{
    ViewBag.Title = "AdvancedSearch";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h4>LogException - Advanced Search</h4>

<!-- Email, Timestamp, Message, Method Name, Source, Stack Trace, Important (both IsImportant? and who marked as important) -->
<!-- Email, Message, MethodName, Source, StackTrace - string search -->
<!-- Timestamp - enter a range of dates -->
<!-- Important - check box for IsImportant? -->
<!-- https://alexkuznetsov.wordpress.com/2013/05/08/asp-net-mvc-pass-dictionary-data-from-view-to-controller/ -->


<form name="myForm">
    @Html.Label("Email")
    @Html.TextBox("EmailAddress")

    @Html.Label("Date Range")
    <div class="container dateRange">
        <div class="block">
            <input name="beginDate" id="beginDate" type="date" min="2019-01-01" />
        </div>
        <div class="block">
            <input name="endDate" id="endDate" type="date" min="2019-01-01" />
        </div>
    </div>

    @Html.Label("Message")
    @Html.TextBox("Message")

    @Html.Label("Method Name")
    @Html.TextBox("MethodName")

    @Html.Label("Source")
    @Html.TextBox("Source")

    @Html.Label("Stack Trace")
    @Html.TextBox("StackTrace")

    @Html.Label("User who marked as important")
    @Html.TextBox("UserImportant")

    Only get logs marked as important <input type="checkbox" name="Important" value="true" />
</form>
<input id="submitForm" type="button" value="Search" />


<script>
    $(document).ready(function () {
        let today = new Date().toISOString().substr(0, 10);
        document.querySelector("#beginDate").max = today;
        document.querySelector("#endDate").max = today;
    });

    $("#submitForm").click(function () {
        var formData = $('form[name="myForm"]').serializeArray();
        debugger;
        var data = {};
        var index = 0;
        formData.forEach(function (pair) {
            var textBoxTitle = pair.name;
            var textboxValue = pair.value;
            if (textboxValue != "") {
                data["searchDictionary[" + index + "].Key"] = textBoxTitle;
                data["searchDictionary[" + index + "].Value"] = textboxValue;
                index++;
            }
        });
        const newform = document.createElement('form');
        newform.method = 'post';
        newform.action = '/LogException/SearchIndex';

        for (const key in data) {
            if (data.hasOwnProperty(key)) {
                const hiddenField = document.createElement('input');
                hiddenField.type = 'hidden';
                hiddenField.name = key;
                hiddenField.value = data[key];

                newform.appendChild(hiddenField);
            }
        }
        document.body.appendChild(newform);
        newform.submit();
    });

</script>